### Problem Statement ###

According to the [U. S. Department of Transportation](https://ops.fhwa.dot.gov/weather/q1_roadimpact.htm), 4% of vehicle crashes in the US are snow-related.  This is quite a significant number, especially considering that snow is seasonal and only common in certain parts of the country.

In this project, neural nets are trained that are capable of automatically detecting falling snow in images.  The ultimate goal is to use neural nets such as these to automatically detect falling snow in live webcam feeds.  This work could be of particular interest to:
- Emergency and transportation personnel, who can use automated snowfall detection to monitor weather conditions on a highly localized level.
- Navigation apps, which can give notifications of weather ahead.
- Ski resorts, which can easily monitor new snowfall on individual ski runs.

### Executive Summary ###

In this project, a Tensorflow pipeline is built that is capable of training convolutional neural nets using 100,000 images with or without falling snow.  See below for details on the source of the data.  The process is carried out on a personal computer with a CUDA-enabled GPU.  The models are evaluated according to precision, recall, f1 score, and accuracy.  Multiple snow classification thresholds are considered to optimize and tune the model to maximize the desired metric.  Finally, a streamlit app is built that can run locally and use one of the saved models to predict whether an uploaded image has falling snow.

This is a field with some existing work. [This paper](https://ieeexplore.ieee.org/document/9119079) and [this company](http://vizzion.com/road-conditions.html) are particularly relevant.  Other related work includes [removal of snow from images](https://sites.google.com/view/yunfuliu/desnownet) and [object detection in poor weather](https://www.kaggle.com/aalborguniversity/aau-rainsnow). The focus here is on identification of snow in images, with removal of snow from those images as a possible future direction.

### Structure of this Repo ###

README.md

LICENSE

Presentation Slides

saved_models:
- test1 and model2: The saved models.
- test1_hist and model2_hist: The training histories of the models saved in .json format.
- csv files: True and predicted labels generated by each model for the images in the dataset.  1 means snow and 0 means clear.

code folder:
- part1_snowdetect_firstfit.ipynb: Preprocessing of images and training of first model.  Model is saved, reloaded, and used to make a prediction on a single image.
- part2_snowdetect_modeltuning.ipynb: A second model is trained.  Classification metrics for both models are examined with different cutoff values for snow classification.  A model is chosen for streamlit deployment, and future directions are discussed.
- presentation_visuals.ipynb: Some figures are recreated and altered to be more suitable for a presentation.
- metricstools.py: A script that contains a function used to check the classification metrics of each model based on generated predictions.
- streamlit.py: A script used to run a streamlit app locally. The app uses the saved model2 to predict whether an uploaded image has falling snow.

data folder:
- The dataset is too large to include here.  Please see below for instructions on where to find it and how to include it so it works with the code in this repo.

### Source and Structure of the Data ###

The data can be found [here](https://sites.google.com/view/yunfuliu/desnownet).  Due to the large overall size of the dataset, the images are not included in this repo.  To import the images and properly assign labels, they should be located at the following paths relative to the Jupyter notebooks:
- ../data/train/clear/
- ../data/train/snow/

At the above website, click the link "Training set."  Save the ground truth (gt) images in the clear folder and the synthetic images in the snow folder.

### Data Preprocessing ###

Before the images could be used to fit the neural nets, several preprocessing steps were necessary.
- Import the file paths of the images.
- Shuffle the file paths (this was done before reading in the images because the images could not all be read into memory at once).
- Split the file paths into training and validation sets.
- Read in the images in batches small enough for working memory to handle.
- Use the filepath to assign a label to each image: 1 for snow, 0 for clear.
- Resize the images to all have size 640x640 pixels.  To avoid stretching the images, a buffer was added as necessary.

### Training and Evaluating the Neural Nets ###

In all, two convolutional neural nets were fit to the data.  They were evaluated based on precision, recall, f1 score, and accuracy.  Both neural nets performed very well, achieving scores of over 98% on all metrics.  The second model was capable of a score of 99.5% on all three metrics simultaneously.  The models could be easily tuned after fitting to increase either precision or recall at the expense of very little accuracy by adjusting the threshold for classifying an image as having snow.

### Streamlit App ###

A streamlit app was written that is capable of using one of the saved models to make a prediction on an image uploaded by a user.  The image can be of several different types or sizes.  It will be converted as needed before being passed to the model.

### Conclusions and Future Directions ###

Overall, the models were very successful.  A simultaneous score of 99.5% on precision, recall, and accuracy, while also being tunable to increase either precision or recall further at minimal cost to accuracy, makes the second model especially well-suited to the task of identifying falling snow in images.  The model was small enough, and performed predictions quickly enough, to be used in a local streamlit app.

There are several possibilities for future directions with this project:
- Although the synthetic data used is excellent for training the model, as the model has no way to fit on features of the images other than the presence or absence of snow, more testing on real images is advisable.
- In-depth analysis of the failure cases could be very helpful for understanding the limitations of the model.
- These models are slightly underfit and have the potential to achieve even better results.  Optimization methods, such as transfer learning, pruning, and quantization, may also be useful for future applications that demand very quick predictions and/or a more complex model.
- The streamlit app that identifies falling snow in a single image can be expanded upon to achieve the ultimate goal of predicting on live webcam feeds.  If necessary, the model may be adapted to a more sophisticated one, such as YOLO.
- Finally, this project can be taken beyond snow detection.  Prior work in this area includes removal of snow from images using a Generative Adversarial Network, which was the original use for the dataset I used for this project.